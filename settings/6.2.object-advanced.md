# 6. Object Cache (Кэширование объектов)
## 6.1. [Basic settings](./6.1.object-basic.md)
## 6.2. Advanced settings

Настройки **Object Cache** в W3 Total Cache оптимизируют производительность WordPress, кэшируя объекты, такие как результаты запросов и мета-данные. Включение полезно для динамичных сайтов (WooCommerce, форумы), но избыточно для простых блогов. На shared-хостинге используйте **Disk**, на VPS — **Memcached/Redis**. Настройте короткий **Default Lifetime** (180–300 секунд) для актуальности данных и **Garbage Collection** (600 секунд) для занятых сайтов. Тестируйте в **Preview Mode** (Performance → General Settings) и очищайте кэш после настройки (Performance → Dashboard → Empty All Caches).

---

## 1. Advanced

### 1.1. Default Lifetime of Cache Objects

- **Описание**: Устанавливает максимальный срок жизни кэшированных объектов (в секундах).
- **Значение по умолчанию**: 180 секунд (3 минуты).
- **Назначение**: Определяет, как долго кэшированные объекты остаются действительными перед их удалением.
- **Пример**: При значении 180 секунд кэш объекта `get_option('siteurl')` обновляется каждые 3 минуты.
- **Рекомендация**:
  - Установите 180–300 секунд для сайтов с динамичным контентом (магазины, новости).
  - Увеличьте до 3600 секунд (1 час) для статичных сайтов.
- **Осторожно**:
  - Долгий срок (например, 86400 секунд) может привести к устаревшим данным.
  - Короткий срок увеличивает обращения к базе данных.

### 1.2. Garbage Collection Interval

- **Описание**: Устанавливает, как часто удаляется устаревший кэш (в секундах), если используется метод **Disk**.
- **Значение по умолчанию**: 600 секунд (10 минут).
- **Пример**: При значении 600 секунд старый кэш удаляется каждые 10 минут, освобождая место.
- **Рекомендация**:
  - Установите 600 секунд для занятых сайтов.
  - Увеличьте до 3600 секунд для слабых серверов.
- **Осторожно**:
  - Частая очистка (например, 60 секунд) увеличивает нагрузку.
  - Не влияет на Memcached/Redis.

### 1.3. Global Groups

- **Описание**: Указывает группы объектов, общие для всех сайтов в мультисайтовой сети WordPress.
- **Пример**: Добавление `users` в Global Groups делает кэш пользовательских данных общим для всех сайтов сети.
- **Назначение**: Обеспечивает согласованность данных в мультисайтовых установках.
- **Рекомендация**:
  - Оставьте пустым, если не используете мультисайтовую сеть.
  - Для мультисайтов добавьте группы, такие как `users`, `userlogins`, `usermeta`, `site-options`.
- **Осторожно**: Неправильные группы могут нарушить функциональность сети.

### 1.4. Non-persistent Groups

- **Описание**: Указывает группы объектов, которые не кэшируются.
- **Пример**: Список по умолчанию (`counts`, `plugins`) исключает кэширование данных, таких как количество комментариев или список плагинов.
- **Назначение**: Предотвращает кэширование данных, которые должны быть всегда актуальными.
- **Рекомендация**:
  - Оставьте по умолчанию (`counts`, `plugins`).
  - Добавьте группы, если плагины используют динамические данные (узнать можно через отладку).
- **Осторожно**: Исключение важных групп может снизить эффективность кэширования.

### 1.5. Enable Caching for wp-admin Requests

- **Описание**: Включает кэширование объектов для запросов в админ-панели WordPress.
- **Пример**: Кэширование `get_option()` в `/wp-admin/` ускоряет загрузку админ-страниц.
- **Рекомендация**:
  - Включите для ускорения админ-панели на крупных сайтах.
  - Отключите, если возникают побочные эффекты (например, устаревшие данные в админке).
- **Осторожно**:
  - Может вызвать проблемы с актуальностью данных (например, при редактировании настроек).
  - Тестируйте тщательно в **Preview Mode**.

### 1.6. Store Transients in Database

- **Описание**: Сохраняет транзиенты (временные данные) в базе данных, даже если используется внешний кэш (Memcached/Redis).
- **Пример**: Транзиент `widget_recent_posts` сохраняется в базе данных, а не только в Redis, чтобы выжить после очистки кэша.
- **Назначение**: Обеспечивает сохранность транзиентов при сбросе внешнего кэша.
- **Рекомендация**:
  - Включите, если транзиенты критичны (например, кэш виджетов или API-ответов).
  - Отключите для уменьшения нагрузки на базу данных.
- **Осторожно**: Увеличивает размер базы данных, особенно на сайтах с множеством транзиентов.

### 1.7. Enable for WP-CLI

- **Описание**: Включает кэширование объектов при использовании WP-CLI.
- **Пример**: Команда `wp option get siteurl` использует кэшированный результат, ускоряя выполнение.
- **Рекомендация**:
  - Включите, если активно используете WP-CLI.
  - Отключите, если WP-CLI требует актуальных данных.
- **Осторожно**: Кэширование может повлиять на точность команд WP-CLI.

---

## 2. Purge via WP Cron

### 2.1. Enable WP-Cron Event

- **Описание**: Включает автоматическую очистку кэша объектов через WP-Cron.
- **Пример**: Включение создаёт задачу WP-Cron для периодической очистки кэша.
- **Рекомендация**:
  - Включите на shared-хостинге.
  - Используйте системный cron (`wp w3tc flush object`) на VPS для надёжности.
- **Осторожно**: WP-Cron ненадёжен на сайтах с низким трафиком.

### 2.2. Start Time

- **Описание**: Устанавливает время начала выполнения задачи WP-Cron.
- **Значение по умолчанию**: 12:00 AM.
- **Пример**: Установка 12:00 AM запускает очистку в полночь.
- **Рекомендация**: Выберите ночное время с низкой нагрузкой.
- **Осторожно**: Если время прошло, задача начнётся на следующий день.

### 2.3. Interval

- **Описание**: Устанавливает интервал выполнения задачи WP-Cron.
- **Значение по умолчанию**: Hourly (каждый час).
- **Пример**: Установка "Hourly" очищает кэш каждый час.
- **Рекомендация**:
  - Используйте "Hourly" для занятых сайтов.
  - Увеличьте до "Daily" для слабых серверов.
- **Осторожно**: Частый интервал увеличивает нагрузку.

---

## Рекомендации для раздела Object Cache

| Настройка | Рекомендация |
| --- | --- |
| Object Cache: Enable | Включить для динамичных сайтов, отключить для простых или при других кэш-плагинах |
| Object Cache Method | **Disk** для shared-хостинга, **Memcached/Redis** для VPS |
| Default Lifetime of Cache Objects | 180–300 секунд для динамичных сайтов, 3600 секунд для статичных |
| Garbage Collection Interval | 600 секунд для занятых сайтов, 3600 секунд для слабых |
| Global Groups | Указать `users`, `site-options` для мультисайтов, иначе пусто |
| Non-persistent Groups | Оставить `counts`, `plugins`, добавить плагин-специфичные |
| Enable Caching for wp-admin Requests | Включить с осторожностью, тестировать |
| Store Transients in Database | Включить для критичных транзиентов |
| Enable for WP-CLI | Включить при активном использовании WP-CLI |
| Enable WP-Cron Event | Включить на shared-хостинге |
| WP-Cron Start Time | Ночное время |
| WP-Cron Interval | Hourly для занятых сайтов, Daily для слабых |

---

## Примеры использования

- **Блог на shared-хостинге**:

  - **Object Cache**: Отключите для простого блога (5–10 запросов).
  - **Object Cache Method**: Если включено, используйте **Disk**.
  - **Default Lifetime**: 3600 секунд.
  - **Garbage Collection**: 3600 секунд.
  - Результат: Экономия ресурсов.

- **WooCommerce на VPS**:

  - **Object Cache**: Включите для кэширования мета-данных товаров.
  - **Object Cache Method**: **Redis**.
  - **Default Lifetime**: 180 секунд.
  - **Non-persistent Groups**: Добавьте `wc_session`.
  - **Store Transients in Database**: Включите.
  - Результат: Ускорение магазина на 20–50%.

- **Новостной сайт на выделенном сервере**:

  - **Object Cache**: Включите для кэширования категорий и комментариев.
  - **Object Cache Method**: **Memcached**.
  - **Default Lifetime**: 300 секунд.
  - **Enable Caching for wp-admin**: Включите для админки.
  - Результат: Быстрая загрузка динамического контента.

---

### Дополнительные советы

- **Object Cache vs. Database Cache**: Предпочтите **Object Cache**, если доступны Memcached/Redis, так как оно эффективнее.
- **Совместимость**: Отключите другие плагины кэширования объектов (WP Redis) для избежания конфликтов.
- **Оптимизация базы данных**: Используйте WP-Optimize и индексы для таблиц.
- **Мониторинг**: Применяйте Query Monitor или New Relic для анализа эффекта.
- **Мультисайты**: Настройте **Global Groups** для согласованности данных.
