# 8. CDN (Content Delivery Network)
## 8.1. Basic settings

Настройка **Content Delivery Network (CDN)** в W3 Total Cache значительно ускоряет загрузку WordPress-сайта, доставляя статические файлы (CSS, JS, изображения) и, при использовании **FSD CDN** (PRO), весь сайт через глобальную сеть серверов. Включите **CDN: Enable** для базовой оптимизации, выберите подходящий **CDN Type** (например, Bunny CDN или Cloudflare), и настройте **FSD CDN** для максимальной производительности. Синхронизируйте с **Browser Cache** и **Security Headers** для комплексной оптимизации. Тестируйте изменения в **Preview Mode** (Performance → General Settings) и очищайте кэш после настройки (Performance → Dashboard → Empty All Caches).

---

### 1. CDN: Enable
  - **Описание**: Активирует интеграцию CDN для доставки статических файлов (тем, медиабиблиотеки, CSS, JS) через сеть серверов CDN.
  - **Назначение**: Включает ускоренную доставку контента, снижая время загрузки для пользователей по всему миру.
  - **Технические детали**:
    - При активации W3 Total Cache переписывает URL статических файлов, указывая на CDN (например, `https://example.com/wp-content/uploads/image.jpg` становится `https://cdn.example.com/wp-content/uploads/image.jpg`).
    - Поддерживает файлы из папок `wp-content`, `wp-includes`, медиабиблиотеки и минифицированных ресурсов.
    - Требует настройки **CDN Type** и ввода учётных данных провайдера (например, API-ключа, URL зоны).
  - **Пример**:
    - Без CDN: Изображение `https://example.com/wp-content/uploads/logo.png` загружается с основного сервера (задержка 200 мс для пользователя из Австралии).
    - С CDN: То же изображение загружается с `https://au.cdn.example.com/wp-content/uploads/logo.png` (задержка 50 мс).
  - **Рекомендация**:
    - Включите для всех WordPress-сайтов, особенно с глобальной аудиторией (например, интернет-магазины, блоги).
    - Убедитесь, что выбранный CDN-провайдер поддерживает HTTPS и имеет серверы в регионах вашей аудитории.
    - Настройте в связке с **Browser Cache** (например, `Cache-Control`, `Expires`) для максимальной эффективности.
  - **Осторожно**:
    - Проверьте совместимость CDN с вашим хостингом и плагинами (некоторые плагины могут конфликтовать с переписыванием URL).
    - Убедитесь, что SSL-сертификат настроен на CDN (особенно для HTTPS-сайтов).
    - Тестируйте в **Preview Mode** перед активацией, чтобы избежать ошибок.

### 2. CDN Type
  - **Описание**: Позволяет выбрать CDN-провайдера или тип интеграции для доставки статических файлов.
  - **Назначение**: Определяет, какой сервис будет использоваться для кэширования и доставки контента.
  - **Технические детали**:
    - Доступные опции в W3 Total Cache:
      - **Generic Mirror**: Универсальный вариант для провайдеров без специфической интеграции.
      - **Amazon CloudFront**: Поддержка AWS CDN.
      - **Akamai**: Для крупных сайтов с высокими требованиями.
      - **Bunny CDN**: Рекомендуемый провайдер (упомянут в интерфейсе), подходит для малого и среднего бизнеса.
      - **Cloudflare**: Популярный выбор с бесплатным планом.
      - **MaxCDN/StackPath**, **KeyCDN**, **Google Cloud CDN**, и другие.
      - **Self-hosted (FTP)**: Загрузка файлов на ваш сервер через FTP (менее распространено).
    - После выбора типа требуется ввести данные (например, API-ключи, URL зоны, регион).
    - Некоторые провайдеры (например, Cloudflare) поддерживают **Full Site Delivery** (FSD CDN) для доставки всего сайта.
  - **Пример**:
    - Выбор **Bunny CDN**:
      - Создаёте Pull Zone в Bunny CDN (например, `example.bunnycdn.com`).
      - Вводите URL зоны и API-ключ в W3 Total Cache.
      - Статические файлы (CSS, JS, изображения) доставляются через `example.bunnycdn.com`.
    - Выбор **Cloudflare**:
      - Указываете зону Cloudflare и API-токен.
      - Поддерживается доставка HTML, CSS, JS, изображений.
  - **Рекомендация**:
    - Выберите провайдера, соответствующий вашим потребностям:
      - **Bunny CDN**: Доступный, с хорошей скоростью и поддержкой HTTPS.
      - **Cloudflare**: Бесплатный план, поддержка FSD CDN, простая интеграция.
      - **Amazon CloudFront**: Для крупных сайтов с AWS-инфраструктурой.
    - Для небольших сайтов начните с **Generic Mirror** или **Bunny CDN**.
    - Синхронизируйте настройки CDN с **Browser Cache** (например, `Cache-Control: max-age=31536000`).
  - **Осторожно**:
    - Неправильные API-ключи или URL зоны приведут к ошибкам загрузки файлов.
    - Некоторые провайдеры требуют ручной настройки DNS (например, CNAME для зоны CDN).
    - Проверьте, поддерживает ли провайдер HTTPS и географическое покрытие вашей аудитории.

### 3. FSD CDN (Full Site Delivery)
  - **Описание**: Активирует доставку всего сайта (включая HTML, медиа, CSS, JS) через CDN. Доступно только в **PRO-версии** W3 Total Cache и требует совместимого провайдера (например, Cloudflare, Akamai).
  - **Назначение**: Обеспечивает минимальное время ответа и загрузки для всех ресурсов сайта, включая динамический контент (HTML), за счёт кэширования на edge-серверах.
  - **Технические детали**:
    - Требуется PRO-лицензия W3 Total Cache.
    - Поддерживается провайдерами с возможностью кэширования HTML (например, Cloudflare с настройкой Page Rules).
    - W3 Total Cache модифицирует все URL сайта, включая страницы (например, `https://example.com/about` → `https://cdn.example.com/about`).
    - Работает в связке с **Page Cache** для кэширования HTML на сервере и CDN.
  - **Пример**:
    - Без FSD CDN: Статические файлы (CSS, JS) доставляются через `cdn.example.com`, но HTML загружается с `example.com` (задержка 150 мс).
    - С FSD CDN: Весь сайт, включая HTML, доставляется через `cdn.example.com` (задержка 50 мс).
  - **Рекомендация**:
    - Включите, если у вас PRO-версия и провайдер поддерживает FSD (например, Cloudflare с Business-планом).
    - Настройте **Page Cache** (например, Disk: Enhanced) для кэширования HTML перед отправкой на CDN.
    - Используйте для сайтов с высокой нагрузкой или глобальной аудиторией (например, новостные порталы, интернет-магазины).
  - **Осторожно**:
    - Требуется тщательная настройка, так как кэширование HTML может нарушить динамический контент (например, корзина WooCommerce).
    - Проверьте совместимость с плагинами, генерирующими динамические страницы.
    - Настройте правила кэширования в CDN (например, исключите `/wp-admin`, корзину, страницы авторизации).
    - Тестируйте в **Preview Mode** и очищайте кэш CDN после изменений.

---

## Примеры использования

- **Блог на shared-хостинге**:
  - Настройка: Включите **CDN: Enable**, выберите **Bunny CDN**, укажите Pull Zone (`example.bunnycdn.com`).
  - Browser Cache: `Cache-Control: max-age=31536000` для CSS/JS.
  - Результат: Изображения и стили загружаются с Bunny CDN, время загрузки сокращается с 2 с до 1 с.

- **WooCommerce на VPS**:
  - Настройка: Включите **CDN: Enable**, выберите **Cloudflare**, настройте **FSD CDN** (PRO), исключите `/cart`, `/checkout` из кэширования.
  - Browser Cache: `Expires: 31536000` для статических файлов.
  - Результат: Весь сайт доставляется через Cloudflare, задержка снижается на 100 мс, корзина остаётся динамической.

- **Новостной сайт на выделенном сервере**:
  - Настройка: Включите **CDN: Enable**, выберите **Amazon CloudFront**, настройте **FSD CDN**, используйте Advanced Settings для исключения `/wp-admin`.
  - Security Headers: `Content-Security-Policy` для защиты.
  - Результат: Глобальная доставка контента, высокая доступность, защита от XSS.

---

## Рекомендации по настройке

| Настройка | Рекомендация | Примечание |
| --- | --- | --- |
| CDN: Enable | Включить | Ускоряет доставку статических файлов; проверьте HTTPS. |
| CDN Type | Bunny CDN или Cloudflare | Bunny CDN для доступности, Cloudflare для FSD и бесплатного плана. |
| FSD CDN | Включить (PRO) | Используйте для глобальных сайтов; исключите динамический контент. |

- **Выбор провайдера**:
  - **Bunny CDN**: Доступный, быстрый, с поддержкой HTTPS и географическим покрытием.
  - **Cloudflare**: Бесплатный план, поддержка FSD CDN, интеграция с DNS.
  - **Amazon CloudFront**: Для крупных сайтов с AWS.
- **Тестирование**:
  - Используйте **Preview Mode** перед активацией.
  - Проверьте загрузку файлов с помощью Chrome DevTools (вкладка Network).
  - Очистите кэш CDN и W3 Total Cache после изменений (Performance → Dashboard → Empty All Caches).
- **Совместимость**:
  - Синхронизируйте настройки **Browser Cache** (`Cache-Control`, `Expires`) с TTL в CDN.
  - Настройте **Security Headers** (например, CSP, HSTS) для защиты контента на CDN.
  - Проверьте плагины (например, WooCommerce, Yoast SEO) на конфликты с переписыванием URL.
